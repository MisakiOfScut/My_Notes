# 中断和中断处理

中断本质是一种特殊的电信号，由硬件设备发送给中断控制器，中断控制器发向处理器。处理器收到中断后，会马上向操作系统反应此信号的到来，然后由操作系统负责这些新到来的数据。

中断不与时钟同步，可以随时产生



每个中断都通过一个唯一的数字标识，操作系统给不同中断提供对应的中断处理程序



### 中断处理程序

在响应一个特定中断的时候，内核会执行一个函数，称为中断处理程序或中断服务例程

中断处理程序与其他内核函数的区别在于，它是运行在**中断上下文**而不是进程

中断程序在执行时，相应的中断线在处理器被屏蔽，防止同一中断线接收另一个新的中断，所以**中断处理程序是无需重入的**



### 中断上下文

中断程序是不可睡眠的，也不能调用会睡眠的函数，因为**没有进程和它关联，无法重新调度它**

中断处理程序**共享所中断进程的内核栈**，内核栈大小是两页



### 中断机制的实现

![image-20210420174715380](C:\Users\misaki\AppData\Roaming\Typora\typora-user-images\image-20210420174715380.png)

内核预先设置了中断处理程序的入口点，即中断代码开始的位置



linux内核提供了 禁止/激活当前处理器的中断 的接口



## 中断的上下半部

一个中断被分为上下部分。中断处理程序是上半部分——接到一个中断它就立即开始运行，但只做有严格时限的工作，这些工作都是在所有中断被禁止的情况下完成的。能够被允许稍后完成的工作会推迟到下半部，此后在合适的时机，下半部会被开中断进行。

下半部的实现机制有软中断（与系统调用的软中断不同）、工作队列和tasklet

